<script>
  (function() {
    var networkStatusSubscribers = [];
    function notifySubscribers() {
      for (var i = 0; i < networkStatusSubscribers.length; ++i) {
        networkStatusSubscribers[i].refreshNetworkStatus();
      }
    }
    window.addEventListener('online', notifySubscribers);
    window.addEventListener('offline', notifySubscribers);

    window.Mixins = window.Mixins || {};
    window.Mixins.AppNetworkStatus = window.Mixins.AppNetworkStatus || function(superClass) {
      return class extends superClass {
        constructor() {
          super();
        }

        connectedCallback() {
          super.connectedCallback();
          networkStatusSubscribers.push(this);
          this.refreshNetworkStatus();
        }

        disconnectedCallback() {
          super.disconnectedCallback();
          var index = networkStatusSubscribers.indexOf(this);
          if (index < 0) {
            return;
          }
          networkStatusSubscribers.splice(index, 1);
        }

        static get properties() {
          return {
            /**
             * True if the browser is online, and false if the browser is offline
             * matching the HTML browser state spec.
             *
             * @type {Boolean}
             */
            online: {
              type: Boolean,
              readOnly: true,
              notify: true,
              value: function() {
                return window.navigator.onLine;
              }
            }
          }
        }

        /**
         * Updates the `online` property to reflect the browser connection status.
         */
        refreshNetworkStatus() {
          this._setOnline(window.navigator.onLine);
        }
      }
    }
  })();
</script>
